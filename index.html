<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Nias Local Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
body{background:#fff6e9;color:#333}
header,footer{background:#8b0000;color:#ffd700;text-align:center;padding:20px}
.produk-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;padding:20px}
.card{background:#fff;border-radius:12px;padding:15px;text-align:center}
.card img{width:100%;height:150px;object-fit:contain}
button{background:#8b0000;color:#fff;border:none;padding:8px 15px;border-radius:20px;cursor:pointer}
.cart{background:#fff;margin:20px;padding:15px;border-radius:12px}
.checkout{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);justify-content:center;align-items:center}
.checkout-box{background:#fff;padding:20px;border-radius:15px;width:90%;max-width:400px}
.review-box{background:#fff;padding:20px;border-radius:15px;margin:20px}
input,textarea{width:100%;padding:8px;margin-top:5px;border-radius:8px;border:1px solid #ccc}
</style>
</head>

<body>

<header>
<h1>Nias Local Store</h1>
<p>Produk Budaya Asli Nias Selatan</p>
</header>

<div class="produk-list" id="produk"></div>

<div class="cart">
<h3>Keranjang</h3>
<div id="cart-items">Kosong</div>
<p><b>Total: Rp <span id="total">0</span></b></p>
<button onclick="openCheckout()">Checkout</button>
</div>

<div class="checkout" id="checkout">
<div class="checkout-box">
<h3>Checkout</h3>
<div id="checkout-items"></div>
<p id="promo-text" style="color:red;font-weight:bold"></p>
<p><b>Total Bayar: Rp <span id="checkout-total">0</span></b></p>
<input id="nama" placeholder="Nama">
<input id="wa" placeholder="No WhatsApp">
<button onclick="kirimWA()">Kirim via WhatsApp</button>
<button onclick="closeCheckout()">Tutup</button>
</div>
</div>

<div class="review-box">
<h3>Ulasan Pembeli</h3>
<input id="review-name" placeholder="Nama">
<textarea id="review-msg" placeholder="Tulis ulasan"></textarea><br><br>
<button onclick="kirimUlasan()">Kirim Ulasan</button>
<hr>
<div id="review-list">Memuat ulasan...</div>
</div>

<footer>
&copy; 2026 Nias Local Store
</footer>

<!-- ================= FIREBASE (FIXED) ================= -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyASzaO6NrAI6xDLGzovLAemwm1FNBrttu0",
  authDomain: "deviniaslokalstore-51c64.firebaseapp.com",
  databaseURL: "https://deviniaslokalstore-51c64-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "deviniaslokalstore-51c64",
  storageBucket: "deviniaslokalstore-51c64.firebasestorage.app",
  messagingSenderId: "477445900444",
  appId: "1:477445900444:web:d6733686105497b362c559"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const reviewRef = db.ref("reviews");

reviewRef.on("value",snap=>{
  const list=document.getElementById("review-list");
  list.innerHTML="";
  snap.forEach(c=>{
    const r=c.val();
    list.innerHTML+=`<p><b>${r.name}</b><br>${r.message}</p><hr>`;
  });
});

function kirimUlasan(){
  const n=review-name.value;
  const m=review-msg.value;
  if(!n||!m) return alert("Lengkapi ulasan");
  reviewRef.push({name:n,message:m,time:Date.now()});
  review-name.value=""; review-msg.value="";
}
</script>

<!-- ================= TOKO ================= -->
<script>
const products=[
{name:"Baju Adat Nias Selatan",price:750000,img:"Baju Adat Nias Selatan.jpg"},
{name:"Baju Adat Nias Utara",price:700000,img:"baju adat nias utara.jpg"},
{name:"Aksesoris Adat",price:150000,img:"Aksesoris.jpg"}
];

let cart=[];
const list=document.getElementById("produk");

products.forEach((p,i)=>{
list.innerHTML+=`
<div class="card">
<img src="${p.img}">
<h4>${p.name}</h4>
<p>Rp ${p.price.toLocaleString()}</p>
<button onclick="addCart(${i})">Tambah</button>
</div>`;
});

function addCart(i){
const f=cart.find(x=>x.i===i);
f?f.q++:cart.push({i,q:1});
renderCart();
}

function renderCart(){
let t=0,h="";
cart.forEach(x=>{
const p=products[x.i];
t+=p.price*x.q;
h+=`${p.name} x ${x.q}<br>`;
});
cart-items.innerHTML=h||"Kosong";
total.innerText=t.toLocaleString();
}

function openCheckout(){
if(!cart.length)return alert("Keranjang kosong");
checkout.style.display="flex";
let t=0,item=0,h="";
cart.forEach(x=>{
const p=products[x.i];
t+=p.price*x.q; item+=x.q;
h+=`${p.name} x ${x.q}<br>`;
});

let diskon=0;
const d=new Date();
if(item>=2 && d.getMonth()==0 && d.getDate()>=13 && d.getDate()<=17){
diskon=t*0.1; t-=diskon;
promo-text.innerText="ðŸŽ‰ Promo 10% diterapkan";
}else promo-text.innerText="";

checkout-items.innerHTML=h;
checkout-total.innerText=t.toLocaleString();
}

function closeCheckout(){checkout.style.display="none";}

function kirimWA(){
if(!nama.value||!wa.value)return alert("Isi nama & WA");
let pesan="Halo Nias Local Store%0A";
cart.forEach(x=>{
const p=products[x.i];
pesan+=`${p.name} x ${x.q}%0A`;
});
window.open("https://wa.me/6285260158352?text="+pesan);
cart=[];renderCart();closeCheckout();
}
</script>

</body>
</html>
